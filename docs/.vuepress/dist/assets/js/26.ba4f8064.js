(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{504:function(s,a,e){"use strict";e.r(a);var t=e(19),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),e("p",[s._v("本文MySQL主从同步是利用MySQL自带的同步功能而实现的")])]),s._v(" "),e("h2",{attrs:{id:"环境准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[s._v("#")]),s._v(" 环境准备")]),s._v(" "),e("blockquote",[e("p",[s._v("OS: CentOS"),e("br"),s._v("\nMySQL: 5.7.x"),e("br"),s._v("\nServer1: 10.10.10.1 master"),e("br"),s._v("\nServer2: 10.10.10.2 slave")])]),s._v(" "),e("p",[s._v("两台服务器防火墙各开放3306端口并重启，不推荐直接关闭防火墙")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("firewall-cmd --zone"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp --permanent\nsystemctl restart firewalld\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("然后ping一下两台服务器，确保两者相通，MySQL安装过程就不叙述，确保两台服务器MySQL版本一致即可")]),s._v(" "),e("h2",{attrs:{id:"配置过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置过程"}},[s._v("#")]),s._v(" 配置过程")]),s._v(" "),e("h3",{attrs:{id:"master配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#master配置"}},[s._v("#")]),s._v(" master配置")]),s._v(" "),e("p",[s._v("修改master"),e("code",[s._v("/etc/my.cnf")]),s._v("文件，添加以下配置")]),s._v(" "),e("div",{staticClass:"language-cnf line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server-id=1   #用于标识，master和slave角色的server-id区分开就行，没有大小之分\nlog-bin=mysql-bin   #binlog文件\nbinlog-do-db=ufind_db   #指定需要同步的数据库，如果需要同步多个数据库，用逗号分隔即可，\n# binlog-ignore-db=mysql   #忽略的数据库，如果需要忽略多个数据库，用逗号分隔即可\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("重启MySQL")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("systemctl restart mysqld\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("使用Native或者登录控制台执行以下sql")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIVILEGES")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'10.10.10.2'")]),s._v(" identified "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password@7902'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflush "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("查看master库状态，如果出现如下字符说明配置正确")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" master "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("+------------------+--------------+-------------------+----------------------------------+\n| File | Position  | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set                 |\n+------------------+----------+--------------+----------------------------------+--------+\n| mysql-bin.000004 | 28125        | ufind_db         | information_schema,cluster,mysql  |\n+------------------+----------+--------------+----------------------------------+--------+\n1 row in set (0.00 sec)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("记录上面显示的File和Position字段，待会从库同步的时候需要用到")]),s._v(" "),e("h3",{attrs:{id:"slave配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#slave配置"}},[s._v("#")]),s._v(" slave配置")]),s._v(" "),e("p",[s._v("修改slave"),e("code",[s._v("/etc/my.cnf")]),s._v("文件，添加以下配置")]),s._v(" "),e("div",{staticClass:"language-cnf line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server-id=1   #用于标识，master和slave角色的server-id区分开就行，没有大小之分\nlog-bin=mysql-bin   #binlog文件\nbinlog-do-db=ufind_db   #指定需要同步的数据库，如果需要同步多个数据库，用逗号分隔即可，\n# binlog-ignore-db=mysql   #忽略的数据库，如果需要忽略多个数据库，用逗号分隔即可\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("使用Native或者登录控制台执行以下sql")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[s._v("change master "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" \nmaster_host"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.10.10.1'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nmaster_user"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nmaster_password"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password@7902'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nmaster_log_file"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000004'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nmaster_log_pos"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("28125")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("启动主从同步")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"查看同步状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看同步状态"}},[s._v("#")]),s._v(" 查看同步状态")]),s._v(" "),e("p",[s._v("在从库执行以下sql")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" slave "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("如果看到一下字段就说明成功"),e("br"),s._v("\nSlave_IO_Running:Yes"),e("br"),s._v("\nSlave_SQL_Running:Yes"),e("br"),s._v("\n当"),e("code",[s._v("Slave_IO_Running")]),s._v("和"),e("code",[s._v("Slave_SQL_Running")]),s._v("状态都是"),e("code",[s._v("Wait")]),s._v("时，说明同步已完成")]),s._v(" "),e("blockquote",[e("p",[s._v("本文作者："),e("a",{attrs:{href:"https://dbsecurity.com.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("许怀安"),e("OutboundLink")],1),s._v(" "),e("br"),s._v("创作时间：2022.07.26\n"),e("br"),s._v("版权声明：本博客所有文章除特别声明外，均采用"),e("a",{attrs:{href:"https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh",target:"_blank",rel:"noopener noreferrer"}},[s._v("BY-NC-SA"),e("OutboundLink")],1),s._v("许可协议。转载请禀明出处！")])])])}),[],!1,null,null,null);a.default=n.exports}}]);