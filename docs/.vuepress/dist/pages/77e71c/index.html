<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernets基于RBAC的认证与授权 | XuHuaian,s Blog</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/images/logo1.png">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_1678482_4tbhmh589x.css">
    <meta name="description" content="记录自己的工作学习心得，争取当一条有梦想的咸鱼">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.87484ee6.css" as="style"><link rel="preload" href="/assets/js/app.88cb2a77.js" as="script"><link rel="preload" href="/assets/js/2.332bd81e.js" as="script"><link rel="preload" href="/assets/js/28.a4cfda65.js" as="script"><link rel="prefetch" href="/assets/js/10.7828cb30.js"><link rel="prefetch" href="/assets/js/11.b60fe74f.js"><link rel="prefetch" href="/assets/js/12.74d6a04b.js"><link rel="prefetch" href="/assets/js/13.71a9ed9b.js"><link rel="prefetch" href="/assets/js/14.31e0ae7c.js"><link rel="prefetch" href="/assets/js/15.bbd5fdd8.js"><link rel="prefetch" href="/assets/js/16.232fa3dc.js"><link rel="prefetch" href="/assets/js/17.e8768a3c.js"><link rel="prefetch" href="/assets/js/18.dc99f565.js"><link rel="prefetch" href="/assets/js/19.a567d982.js"><link rel="prefetch" href="/assets/js/20.a87ff69b.js"><link rel="prefetch" href="/assets/js/21.151de93c.js"><link rel="prefetch" href="/assets/js/22.b9727372.js"><link rel="prefetch" href="/assets/js/23.9f002375.js"><link rel="prefetch" href="/assets/js/24.da94337b.js"><link rel="prefetch" href="/assets/js/25.da0fcf9b.js"><link rel="prefetch" href="/assets/js/26.ba4f8064.js"><link rel="prefetch" href="/assets/js/27.dec78201.js"><link rel="prefetch" href="/assets/js/29.97d4e455.js"><link rel="prefetch" href="/assets/js/3.0a86ad40.js"><link rel="prefetch" href="/assets/js/30.68913d0c.js"><link rel="prefetch" href="/assets/js/31.8e623e74.js"><link rel="prefetch" href="/assets/js/4.d3d67b90.js"><link rel="prefetch" href="/assets/js/5.1a604d7f.js"><link rel="prefetch" href="/assets/js/6.103c225d.js"><link rel="prefetch" href="/assets/js/7.87b23a9a.js"><link rel="prefetch" href="/assets/js/8.05891713.js"><link rel="prefetch" href="/assets/js/9.68e9dd0e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.87484ee6.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.jpg" alt="XuHuaian,s Blog" class="logo"> <span class="site-name can-hide">XuHuaian,s Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>gRP笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/52d5c3/" class="nav-link">RPC</a></li><li class="dropdown-subitem"><a href="/pages/a2f161/" class="nav-link">gRPC</a></li><li class="dropdown-subitem"><a href="/pages/793dcb/" class="nav-link">Hello gRPC</a></li><li class="dropdown-subitem"><a href="/pages/2f674a/" class="nav-link">gRPC Bug</a></li></ul></li><li class="dropdown-item"><h4>HuTool笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5fedc1/" class="nav-link">HuTool</a></li><li class="dropdown-subitem"><a href="/pages/f83d9d/" class="nav-link">HuTool组件</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/82aec0/" class="nav-link">使用systemctl命令管理部署Java jar包</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/af9ce4/" class="nav-link">挖矿病毒排杀过程</a></li><li class="dropdown-subitem"><a href="/pages/11d270/" class="nav-link">主机巡检脚本</a></li></ul></li><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/af9ce4/" class="nav-link">主从同步</a></li><li class="dropdown-subitem"><a href="/pages/f5d269/" class="nav-link">查询关键字详解</a></li></ul></li><li class="dropdown-item"><h4>Kubernetes</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/52d291/" class="nav-link">Kubernetes架构</a></li><li class="dropdown-subitem"><a href="/pages/77e71c/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Kubernets基于RBAC的认证与授权</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络安全" class="dropdown-title"><!----> <span class="title" style="display:;">网络安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>网络安全</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bd3bd3/" class="nav-link">浅谈网络安全</a></li></ul></li><li class="dropdown-item"><h4>主机安全</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b5a32b/" class="nav-link">Centos主机安全加固</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><!----> <span class="title" style="display:;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>博客搭建</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/0737a0/" class="nav-link">Vuepress搭建博客</a></li><li class="dropdown-subitem"><a href="/pages/c21fef/" class="nav-link">微信云托管部署Vuepress</a></li></ul></li><li class="dropdown-item"><h4>踩坑记录</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9c7c7b/" class="nav-link">Nginx报错403</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><!----> <span class="title" style="display:;">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/db78e2/" class="nav-link">关于我</a></li><li class="dropdown-item"><!----> <a href="/pages/0f7590/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/keington/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/images/logo.jpg"> <div class="blogger-info"><h3>许怀安</h3> <span>所思，所学，所想，所行</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>gRP笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/52d5c3/" class="nav-link">RPC</a></li><li class="dropdown-subitem"><a href="/pages/a2f161/" class="nav-link">gRPC</a></li><li class="dropdown-subitem"><a href="/pages/793dcb/" class="nav-link">Hello gRPC</a></li><li class="dropdown-subitem"><a href="/pages/2f674a/" class="nav-link">gRPC Bug</a></li></ul></li><li class="dropdown-item"><h4>HuTool笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5fedc1/" class="nav-link">HuTool</a></li><li class="dropdown-subitem"><a href="/pages/f83d9d/" class="nav-link">HuTool组件</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/82aec0/" class="nav-link">使用systemctl命令管理部署Java jar包</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/af9ce4/" class="nav-link">挖矿病毒排杀过程</a></li><li class="dropdown-subitem"><a href="/pages/11d270/" class="nav-link">主机巡检脚本</a></li></ul></li><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/af9ce4/" class="nav-link">主从同步</a></li><li class="dropdown-subitem"><a href="/pages/f5d269/" class="nav-link">查询关键字详解</a></li></ul></li><li class="dropdown-item"><h4>Kubernetes</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/52d291/" class="nav-link">Kubernetes架构</a></li><li class="dropdown-subitem"><a href="/pages/77e71c/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Kubernets基于RBAC的认证与授权</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络安全" class="dropdown-title"><!----> <span class="title" style="display:;">网络安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>网络安全</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bd3bd3/" class="nav-link">浅谈网络安全</a></li></ul></li><li class="dropdown-item"><h4>主机安全</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b5a32b/" class="nav-link">Centos主机安全加固</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><!----> <span class="title" style="display:;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>博客搭建</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/0737a0/" class="nav-link">Vuepress搭建博客</a></li><li class="dropdown-subitem"><a href="/pages/c21fef/" class="nav-link">微信云托管部署Vuepress</a></li></ul></li><li class="dropdown-item"><h4>踩坑记录</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9c7c7b/" class="nav-link">Nginx报错403</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><!----> <span class="title" style="display:;">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/db78e2/" class="nav-link">关于我</a></li><li class="dropdown-item"><!----> <a href="/pages/0f7590/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/keington/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Kubernetes</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/52d291/" class="sidebar-link">Kubernetes架构</a></li><li><a href="/pages/77e71c/" aria-current="page" class="active sidebar-link">Kubernets基于RBAC的认证与授权</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/77e71c/#集群认证和授权-rbac" class="sidebar-link">集群认证和授权(RBAC)</a></li><li class="sidebar-sub-header"><a href="/pages/77e71c/#授权管理" class="sidebar-link">授权管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/77e71c/#授权模式" class="sidebar-link">授权模式</a></li><li class="sidebar-sub-header"><a href="/pages/77e71c/#支持的模式" class="sidebar-link">支持的模式：</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/77e71c/#role管理" class="sidebar-link">Role管理</a></li><li class="sidebar-sub-header"><a href="/pages/77e71c/#角色分类" class="sidebar-link">角色分类</a></li><li class="sidebar-sub-header"><a href="/pages/77e71c/#cluster-role管理" class="sidebar-link">Cluster Role管理</a></li><li class="sidebar-sub-header"><a href="/pages/77e71c/#service-account" class="sidebar-link">Service Account</a></li><li class="sidebar-sub-header"><a href="/pages/77e71c/#用户授权案例" class="sidebar-link">用户授权案例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/77e71c/#账户创建与绑定" class="sidebar-link">账户创建与绑定</a></li><li class="sidebar-sub-header"><a href="/pages/77e71c/#生成kubeconfig文件" class="sidebar-link">生成kubeconfig文件</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/categories/?category=%E8%BF%90%E7%BB%B4" title="分类" data-v-0c557b5e>运维</a></li><li data-v-0c557b5e><a href="/categories/?category=Kubernetes" title="分类" data-v-0c557b5e>Kubernetes</a></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="https://github.com/keington" target="_blank" title="作者" class="beLink" data-v-0c557b5e>许怀安</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-12-19</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Kubernets基于RBAC的认证与授权<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="集群认证和授权-rbac"><a href="#集群认证和授权-rbac" class="header-anchor">#</a> 集群认证和授权(RBAC)</h2> <p>主体（subject）----&gt;认证-----&gt;授权（action）-----&gt;准入控制（object）</p> <blockquote><p>subject：表示三类主体，user，group，serviceAccount。<br>
action：能对Object做什么，例如：get、list、watch、patch、delete、update、create等。<br>
object：主要表现为以下三类对象。<br>
Resource：代表一类资源，也被称为Resource Group，例如Secret。<br>
Resource Names：代表ResourceGroup中具体的单个资源。<br>
Non-Resource URLs：它被称为非资源URL或称为虚拟URL对象，是k8s中所需要的特殊动作（不需要多关注）。</p></blockquote> <h2 id="授权管理"><a href="#授权管理" class="header-anchor">#</a> 授权管理</h2> <h3 id="授权模式"><a href="#授权模式" class="header-anchor">#</a> 授权模式</h3> <p>授权模式定义认证成功的用户对集群的操作权限，有kube-apiserver配置文件定义:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/kubernetes/manifests/kube-apiserver.yaml
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token comment">#在spec.containers下的command中添加参数--authorization-mode指定</span>
spec:
 containers:
  - command:
    - --authorization-mode<span class="token operator">=</span>Node,RBAC
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="支持的模式"><a href="#支持的模式" class="header-anchor">#</a> 支持的模式：</h3> <blockquote><p>AlwaysAllow，允许用户所有请求。<br>
AlwaysDeny，拒绝用户所有请求，不管用户是否具有权限，但不限制admin用户。<br>
ABAC，Attribute Based Access Control，详情参考ABAC。<br>
Webhook，详情参考Webhook。<br>
RBAC，Role Based Access Control，基于角色的访问控制，只有明确了赋予用户权限，用户才能执行相关操作。<br>
Node，用于各个node上的kubelet访问apiserver时使用。<br></p></blockquote> <h2 id="role管理"><a href="#role管理" class="header-anchor">#</a> Role管理</h2> <p>kubernetes为了方便管理权限，将一组特定权限赋予角色，然后将角色赋予用户，那么用户将继承该角色具有的权限。</p> <p>Role: 定义一组规则，用于访问某一命名空间中的Kubernetes资源。</p> <h2 id="角色分类"><a href="#角色分类" class="header-anchor">#</a> 角色分类</h2> <blockquote><p>role，namespace角色，限定用户访问特定namespace。role绑定给用户，称之为rolebinding <br>
clusterrole，集群角色，可以管理集群，包括所有namespace中资源。clusterrole绑定给用户，称之为clusterrolebinding <br></p></blockquote> <p>权限由kubernetes系统预定义的，clusterroles/admin中包涵系统中全部权限列表。</p> <h2 id="cluster-role管理"><a href="#cluster-role管理" class="header-anchor">#</a> Cluster Role管理</h2> <p>ClusterRole: 定义了一组访问集群中Kubernetes资源(包括所有命名空间)的规则。</p> <p>kubernetes系统中已经预定义了很多cluster role，常见的clusterrole如下：</p> <blockquote><p>view，对系统中几乎所有的对象都有get、list和watch权限。<br>
edit，对系统中几乎所有的对象都有get、list和watch权限。其中部分对象额外具有create、delete、deletecollection、patch、update权限。<br>
admin，对系统中大部分的对象具有所有权限。基本上用于绑定用户到特定namespace中<br>
cluster-admin，对系统中所有的对象具有所有权限。<br></p></blockquote> <h2 id="service-account"><a href="#service-account" class="header-anchor">#</a> Service Account</h2> <p>Service Account，即服务账户，pod使用Service Account身份运行容器。</p> <p>赋予Service Account相应角色，则使用该Service Account身份运行的pod中进程将具有对应Service Account的权限。</p> <p>在每个namespace中都有一个名称为default的Service Account。每个Service Account都有一个Secret。</p> <p>sa会创建一个secret，pod或deployment使用sa账户时，会将sa的secret进行挂载到pods中使用。</p> <h2 id="用户授权案例"><a href="#用户授权案例" class="header-anchor">#</a> 用户授权案例</h2> <h3 id="账户创建与绑定"><a href="#账户创建与绑定" class="header-anchor">#</a> 账户创建与绑定</h3> <ol><li>创建指定namespace</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl create namespace

kubectl config set-context --current --namespace rbac
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>创建sa账户</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl create serviceaccount user1

kubectl get sa
NAME      SECRETS   AGE
default   <span class="token number">0</span>         5m
lxh       <span class="token number">0</span>         57s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="3"><li>创建role角色，normal-user</li></ol> <p>针对rbac名称空间下的pod拥有查看、修改和删除权限。</p> <p>针对rbac名称空间下的deployment查看的权限,不具有修改和删除权限。</p> <p>创建<strong>role.yaml</strong>文件</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> rbac
  <span class="token key atrule">name</span><span class="token punctuation">:</span> normal<span class="token punctuation">-</span>user
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pods/exec&quot;</span><span class="token punctuation">]</span>
  <span class="token comment">#verbs: [&quot;*&quot;]</span>
  <span class="token comment">##RO-Role</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">]</span>


<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pods&quot;</span><span class="token punctuation">]</span>
  <span class="token comment">#verbs: [&quot;*&quot;]</span>
  <span class="token comment">##RO-Role</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span>

<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;apps/v1&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;deployments&quot;</span><span class="token punctuation">]</span>
  <span class="token comment">#verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;, &quot;delete&quot;]</span>
  <span class="token comment">##RO-Role</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl apply -f role.yaml

kubectl get role
NAME          CREATED AT
normal-user   <span class="token number">2022</span>-12-19T21:19:11Z
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="4"><li>将sa账户绑定到role normal-user角色</li></ol> <p>创建<strong>rolebinding.yaml</strong>文件</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> role<span class="token punctuation">-</span>bind
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> rbac
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> lxh
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> rbac
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> normal<span class="token punctuation">-</span>user
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl apply -f role-bind.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="5"><li>查看sa账户绑定role角色</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl get rolebindings.rbac.authorization.k8s.io -o yaml

apiVersion: v1
items:
- apiVersion: rbac.authorization.k8s.io/v1
  kind: RoleBinding
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: <span class="token operator">|</span>
        <span class="token punctuation">{</span><span class="token string">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;rbac.authorization.k8s.io/v1&quot;</span>,<span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;RoleBinding&quot;</span>,<span class="token string">&quot;metadata&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;annotations&quot;</span>:<span class="token punctuation">{</span><span class="token punctuation">}</span>,<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;role-bind&quot;</span>,<span class="token string">&quot;namespace&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;rbac&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;roleRef&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;apiGroup&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;rbac.authorization.k8s.io&quot;</span>,<span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;Role&quot;</span>,<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;normal-user&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;subjects&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ServiceAccount&quot;</span>,<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;user1&quot;</span>,<span class="token string">&quot;namespace&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;rbac&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
    creationTimestamp: <span class="token string">&quot;2022-12-19T21:19:11Z&quot;</span>
    name: role-bind
    namespace: rbac
    resourceVersion: <span class="token string">&quot;712005&quot;</span>
    uid: d3e3daf6-0eea-425b-9e5a-335ad0406722
  roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: Role
    name: normal-user
  subjects:
  - kind: ServiceAccount
    name: lxh
    namespace: rbac
kind: List
metadata:
  resourceVersion: <span class="token string">&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ol start="6"><li>创建sa账户secret类型token（1.23版本前不需要手动创建）</li></ol> <p>创建<strong>sa-token.yaml</strong>文件</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">type</span><span class="token punctuation">:</span> kubernetes.io/service<span class="token punctuation">-</span>account<span class="token punctuation">-</span>token
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> lxh<span class="token punctuation">-</span>token
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> rbac
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">kubernetes.io/service-account.name</span><span class="token punctuation">:</span> <span class="token string">&quot;user1&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl apply -f sa-token.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="7"><li>查看sa账户secret类型token</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl describe secrets user1-token <span class="token operator">|</span> <span class="token function">grep</span> token
Name:         user1-token
Type:  kubernetes.io/service-account-token
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IlpLSTRfNW4wYy1ncDdHaS1zQjVvWXRjVHUzam8zazNwd3NmQzJtVVctb2MifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJyYmFjIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6Imx4aC10b2tlbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJseGgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI0MjdhMDdmNi1hYzNhLTRjZDItYWViNC0xOGJlMTNhYjZiZTIiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6cmJhYzpseGgifQ.UnCLtXk96Ycj30jR_4NAaIxwfoSoeg36Clvgnc6UOJAdhf2f5jMSvw174AshDZfcDb4S-gWZbRNeN0-RsT8MocXqa37LQg_ZgoMQAhAvc7fxH32dhoPENrIvX63z9KISCpFqdeU5AX4vL_XIH9LXXjOdcbALYMsiDw_DwupLqajzIyzuu9aCMqrrAVA-RUtnKRaRfCWw4hL0Y39hKpf0QxEnY7jzrg906-6Kcl7zC9izkEb4WMG2Fsw0USGNEnjWPcI1DaZtXIpUnHOecpZlgpWFCSZwaldz3TI0QMzhCTi3nVKUkz3iVjiYUoOpKS5buTFfBJNyolRkgsw-H3bqlQ
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="生成kubeconfig文件"><a href="#生成kubeconfig文件" class="header-anchor">#</a> 生成kubeconfig文件</h3> <p>创建证书目录</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> /root/rbac/certs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol><li>生成csr证书</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> /root/rbac/certs/user1-csr.json
<span class="token punctuation">{</span>
  <span class="token string">&quot;CN&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;China&quot;</span>,
  <span class="token string">&quot;hosts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;key&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;algo&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rsa&quot;</span>,
    <span class="token string">&quot;size&quot;</span><span class="token builtin class-name">:</span> <span class="token number">2048</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;names&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string">&quot;C&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;CN&quot;</span>,
      <span class="token string">&quot;ST&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;BeiJing&quot;</span>,
      <span class="token string">&quot;L&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;BeiJing&quot;</span>,
      <span class="token string">&quot;O&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;k8s&quot;</span>,
      <span class="token string">&quot;OU&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;System&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ol start="2"><li>签发证书</li></ol> <p>cfssl安装，在master节点执行</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> https://pkg.cfssl.org/R1.2/cfssl_linux-amd64
<span class="token function">wget</span> https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64
<span class="token function">wget</span> https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 

<span class="token function">mv</span> cfssl-certinfo_1.6.1_linux_amd64 cfssl-certinfo
<span class="token function">mv</span> cfssl_1.6.1_linux_amd64 cfssl
<span class="token function">mv</span> cfssljson_1.6.1_linux_amd64 cfssljson

<span class="token function">chmod</span> a+x cfssl-certinfo cfssl cfssljson
<span class="token function">cp</span> cfssl-certinfo cfssl cfssljson /usr/local/bin/

<span class="token comment"># 测试</span>
cfssl version

<span class="token comment"># 从部署节点deploy拷贝集群证书文件到master节点</span>

<span class="token function">scp</span> /etc/kubeasz/clusters/k8s-cluster1/ssl/ca-config.json master1:/root/rbac/certs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>签发证书</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cfssl gencert -ca<span class="token operator">=</span>/etc/kubernetes/ssl/ca.pem -ca-key<span class="token operator">=</span>/etc/kubernetes/ssl/ca-key.pem -config<span class="token operator">=</span>./ca-config.json -profile<span class="token operator">=</span>kubernetes ./user1.json <span class="token operator">|</span> cfssljson -bare user1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>生成集群配置文件kubenetes config</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl config set-cluster cluster1 <span class="token punctuation">\</span>
--certificate-authority<span class="token operator">=</span>/etc/kubernetes/ssl/ca.pem <span class="token punctuation">\</span>
--embed-certs<span class="token operator">=</span>true <span class="token punctuation">\</span>
--server<span class="token operator">=</span>https://192.168.100.2:6443 <span class="token punctuation">\</span>
--kubeconfig<span class="token operator">=</span>./user.kubeconfig
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li>设置客户端认证</li></ol> <p>复制用户证书到k8s集群证书目录下</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> user1*.pem /etc/kubernetes/ssl/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建用户认证到集群配置文件</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl config set-credentials user1 <span class="token punctuation">\</span>
--client-certificate<span class="token operator">=</span>/etc/kubernetes/ssl/user1.pem <span class="token punctuation">\</span>
--client-key<span class="token operator">=</span>/etc/kubernetes/ssl/user1-key.pem <span class="token punctuation">\</span>
--embed-certs<span class="token operator">=</span>true <span class="token punctuation">\</span>
--kubeconfig<span class="token operator">=</span>./user.kubeconfig
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="4"><li>设置上下文</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ubectl config set-context cluster1 <span class="token punctuation">\</span>
--cluster<span class="token operator">=</span>cluster1 <span class="token punctuation">\</span>
--user<span class="token operator">=</span>user1 <span class="token punctuation">\</span>
--namespace<span class="token operator">=</span>rbac <span class="token punctuation">\</span>
--kubeconfig<span class="token operator">=</span>./user.kubeconfig
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="5"><li>设置默认上下文</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl config use-context cluster1 --kubeconfig<span class="token operator">=</span>user.kubeconfig
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="6"><li>追加用户token到集群配置文件
将刚才获取道到的token追加至user.kubeconfig最后，保存即可</li></ol> <blockquote><p>本文作者：<a href="https://dbsecurity.com.cn/" target="_blank" rel="noopener noreferrer">许怀安<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <br>创作时间：2022.12.19
<br>版权声明：本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener noreferrer">BY-NC-SA<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>许可协议。转载请禀明出处！</p></blockquote></div></div> <div class="page-slot page-slot-bottom">
  <div class="wwads-cn wwads-horizontal pageB" data-id="136" style="width:100%;max-height:80px;min-height:auto;"></div>
  <style>
    .pageB img{width:80px!important;}
    .wwads-horizontal .wwads-text, .wwads-content .wwads-text{line-height:1;}
  </style>
  </div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/12/19, 23:30:50</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/52d291/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Kubernetes架构</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/52d291/" class="prev">Kubernetes架构</a></span> <!----></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:keington@outlook.com" title="Email" target="_blank" class="iconfont icon-youjian"></a><a href="tencent://message/?uin=qq1950974755&amp;Site=Sambow&amp;Menu=yes" title="QQ" target="_blank" class="iconfont icon-QQ"></a><a href="https://github.com/keington/" title="Github" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/keington/" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
    | Copyright © 2020-2023
    <span>许怀安 | MIT License </br><a target="_blank" href="http://beian.miit.gov.cn/" >青ICP备2022000072号-1</a><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=63010302000386" > | 青公网安备 63010302000386号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div>
    <div class="wwads-cn wwads-vertical windowRB" data-id="136" style="max-width:160px;
    min-width: auto;min-height:auto;"></div>
    <style>
      .windowRB{ padding: 0;}
      .windowRB .wwads-img{margin-top: 10px;}
      .windowRB .wwads-content{margin: 0 10px 10px 10px;}
      .custom-html-window-rb .close-but{
        display: none;
      }
    </style>
  </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.88cb2a77.js" defer></script><script src="/assets/js/2.332bd81e.js" defer></script><script src="/assets/js/28.a4cfda65.js" defer></script>
  </body>
</html>
