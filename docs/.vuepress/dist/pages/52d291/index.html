<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes架构 | XuHuaian,s Blog</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/images/logo1.png">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_1678482_4tbhmh589x.css">
    <meta name="description" content="记录自己的工作学习心得，争取当一条有梦想的咸鱼">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.87484ee6.css" as="style"><link rel="preload" href="/assets/js/app.d8da32ae.js" as="script"><link rel="preload" href="/assets/js/2.f60e7fe1.js" as="script"><link rel="preload" href="/assets/js/10.9e8339da.js" as="script"><link rel="prefetch" href="/assets/js/11.b60fe74f.js"><link rel="prefetch" href="/assets/js/12.b76e71f3.js"><link rel="prefetch" href="/assets/js/13.9d7e48fe.js"><link rel="prefetch" href="/assets/js/14.31e0ae7c.js"><link rel="prefetch" href="/assets/js/15.bbd5fdd8.js"><link rel="prefetch" href="/assets/js/16.fd9c3895.js"><link rel="prefetch" href="/assets/js/17.c82139da.js"><link rel="prefetch" href="/assets/js/18.b5de0f01.js"><link rel="prefetch" href="/assets/js/19.56d874c7.js"><link rel="prefetch" href="/assets/js/20.565e03e4.js"><link rel="prefetch" href="/assets/js/21.077ce254.js"><link rel="prefetch" href="/assets/js/22.a62bd687.js"><link rel="prefetch" href="/assets/js/23.7a343e63.js"><link rel="prefetch" href="/assets/js/24.0c8ba337.js"><link rel="prefetch" href="/assets/js/25.24dd72b4.js"><link rel="prefetch" href="/assets/js/26.aa56897a.js"><link rel="prefetch" href="/assets/js/27.dbda1b48.js"><link rel="prefetch" href="/assets/js/28.8de8da94.js"><link rel="prefetch" href="/assets/js/29.53b81454.js"><link rel="prefetch" href="/assets/js/3.2aef48b0.js"><link rel="prefetch" href="/assets/js/30.f9123f88.js"><link rel="prefetch" href="/assets/js/4.d3d67b90.js"><link rel="prefetch" href="/assets/js/5.71ed2583.js"><link rel="prefetch" href="/assets/js/6.103c225d.js"><link rel="prefetch" href="/assets/js/7.a3f4706d.js"><link rel="prefetch" href="/assets/js/8.d0603362.js"><link rel="prefetch" href="/assets/js/9.c4417b2e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.87484ee6.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.jpg" alt="XuHuaian,s Blog" class="logo"> <span class="site-name can-hide">XuHuaian,s Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>gRP笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/52d5c3/" class="nav-link">RPC</a></li><li class="dropdown-subitem"><a href="/pages/a2f161/" class="nav-link">gRPC</a></li><li class="dropdown-subitem"><a href="/pages/793dcb/" class="nav-link">Hello gRPC</a></li><li class="dropdown-subitem"><a href="/pages/2f674a/" class="nav-link">gRPC Bug</a></li></ul></li><li class="dropdown-item"><h4>HuTool笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5fedc1/" class="nav-link">HuTool</a></li><li class="dropdown-subitem"><a href="/pages/f83d9d/" class="nav-link">HuTool组件</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/82aec0/" class="nav-link">使用systemctl命令管理部署Java jar包</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/af9ce4/" class="nav-link">Linux下挖矿病毒排杀过程</a></li></ul></li><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/af9ce4/" class="nav-link">MySQL主从同步</a></li></ul></li><li class="dropdown-item"><h4>Kubernetes</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/52d291/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Kubernetes架构</a></li><li class="dropdown-subitem"><a href="/pages/77e71c/" class="nav-link">Kubernets基于RBAC的认证与授权</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络安全" class="dropdown-title"><!----> <span class="title" style="display:;">网络安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>网络安全</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bd3bd3/" class="nav-link">浅谈网络安全</a></li></ul></li><li class="dropdown-item"><h4>主机安全</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b5a32b/" class="nav-link">Centos主机安全加固</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><!----> <span class="title" style="display:;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>博客搭建</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/0737a0/" class="nav-link">Vuepress搭建博客</a></li><li class="dropdown-subitem"><a href="/pages/c21fef/" class="nav-link">微信云托管部署Vuepress</a></li></ul></li><li class="dropdown-item"><h4>踩坑记录</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9c7c7b/" class="nav-link">Nginx报错403</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><!----> <span class="title" style="display:;">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/db78e2/" class="nav-link">关于我</a></li><li class="dropdown-item"><!----> <a href="/pages/0f7590/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/keington/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/images/logo.jpg"> <div class="blogger-info"><h3>许怀安</h3> <span>所思，所学，所想，所行</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>gRP笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/52d5c3/" class="nav-link">RPC</a></li><li class="dropdown-subitem"><a href="/pages/a2f161/" class="nav-link">gRPC</a></li><li class="dropdown-subitem"><a href="/pages/793dcb/" class="nav-link">Hello gRPC</a></li><li class="dropdown-subitem"><a href="/pages/2f674a/" class="nav-link">gRPC Bug</a></li></ul></li><li class="dropdown-item"><h4>HuTool笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5fedc1/" class="nav-link">HuTool</a></li><li class="dropdown-subitem"><a href="/pages/f83d9d/" class="nav-link">HuTool组件</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/82aec0/" class="nav-link">使用systemctl命令管理部署Java jar包</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/af9ce4/" class="nav-link">Linux下挖矿病毒排杀过程</a></li></ul></li><li class="dropdown-item"><h4>MySQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/af9ce4/" class="nav-link">MySQL主从同步</a></li></ul></li><li class="dropdown-item"><h4>Kubernetes</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/52d291/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Kubernetes架构</a></li><li class="dropdown-subitem"><a href="/pages/77e71c/" class="nav-link">Kubernets基于RBAC的认证与授权</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络安全" class="dropdown-title"><!----> <span class="title" style="display:;">网络安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>网络安全</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bd3bd3/" class="nav-link">浅谈网络安全</a></li></ul></li><li class="dropdown-item"><h4>主机安全</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b5a32b/" class="nav-link">Centos主机安全加固</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><!----> <span class="title" style="display:;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>博客搭建</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/0737a0/" class="nav-link">Vuepress搭建博客</a></li><li class="dropdown-subitem"><a href="/pages/c21fef/" class="nav-link">微信云托管部署Vuepress</a></li></ul></li><li class="dropdown-item"><h4>踩坑记录</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9c7c7b/" class="nav-link">Nginx报错403</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><!----> <span class="title" style="display:;">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/db78e2/" class="nav-link">关于我</a></li><li class="dropdown-item"><!----> <a href="/pages/0f7590/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/keington/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/af9ce4/" class="sidebar-link">Linux下病毒排杀过程</a></li><li><a href="/pages/11d270/" class="sidebar-link">Linux主机巡检脚本</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>MySQL</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/fe78f5/" class="sidebar-link">MySQL主从同步</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Kubernetes</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/52d291/" aria-current="page" class="active sidebar-link">Kubernetes架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/52d291/#etcd" class="sidebar-link">etcd</a></li><li class="sidebar-sub-header"><a href="/pages/52d291/#api-server" class="sidebar-link">API Server</a></li><li class="sidebar-sub-header"><a href="/pages/52d291/#controller-manager" class="sidebar-link">Controller Manager</a></li><li class="sidebar-sub-header"><a href="/pages/52d291/#scheduler" class="sidebar-link">Scheduler</a></li><li class="sidebar-sub-header"><a href="/pages/52d291/#kubelet" class="sidebar-link">Kubelet</a></li><li class="sidebar-sub-header"><a href="/pages/52d291/#kube-proxy" class="sidebar-link">kube-proxy</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/52d291/#参考资料" class="sidebar-link">参考资料</a></li></ul></li></ul></li><li><a href="/pages/77e71c/" class="sidebar-link">Kubernets基于RBAC的认证与授权</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/categories/?category=%E8%BF%90%E7%BB%B4" title="分类" data-v-0c557b5e>运维</a></li><li data-v-0c557b5e><a href="/categories/?category=Kubernetes" title="分类" data-v-0c557b5e>Kubernetes</a></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="https://github.com/keington" target="_blank" title="作者" class="beLink" data-v-0c557b5e>许怀安</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-06-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Kubernetes架构<!----></h1>  <div class="theme-vdoing-content content__default"><p><img src="/assets/img/kubernetes.c5f52bf8.png" alt="avatar"></p> <h1 id="控制平面组件"><a href="#控制平面组件" class="header-anchor">#</a> 控制平面组件</h1> <h2 id="etcd"><a href="#etcd" class="header-anchor">#</a> etcd</h2> <p>etcd 是一个快速、分布式、一致的键值存储，用作持久存储 Kubernetes 对象数据（如 pod、replication controllers, secrets, services 等）的后备存储。实际上，etcd 是 Kubernetes 存储集群状态和元数据的唯一地方。唯一直接与 etcd 对话的组件是 Kubernetes API Server。所有其他组件通过 API Server 间接读取和写入数据到 etcd。</p> <p>Etcd 还实现了一个监视功能，它提供了一个基于事件的接口，用于异步监控键的更改。一旦密钥被更改，它的观察者就会收到通知。API Server 组件在很大程度上依赖于此来获得通知并将 etcd 的当前状态移动到所需状态。</p> <p><strong>etcd 实例的数量应该是奇数吗？</strong></p> <p>在 HA 环境中，通常会运行 3、5 或 7 个 etcd 实例，但为什么呢？由于 etcd 是分布式数据存储，因此可以水平扩展它，但您还需要确保每个实例中的数据是一致的，为此，您的系统需要就状态达成共识。Etcd 为此使用了RAFT <font color="blue"><strong>共识算法[1]</strong></font>。</p> <p>该算法需要多数（或仲裁）集群才能进入下一个状态。如果您只有 2 个 ectd 实例，如果其中任何一个失败，则 etcd 集群无法转换到新状态，因为不存在多数，并且在 3 个实例的情况下，一个实例可能会失败并且可以达到多数的实例仍然可用。</p> <h2 id="api-server"><a href="#api-server" class="header-anchor">#</a> API Server</h2> <p>API Server 是 Kubernetes 中唯一与 etcd 直接交互的组件。Kubernetes 以及客户端（kubectl）中的所有其他组件都必须通过 API Server 来处理集群状态。API Server 提供以下功能：</p> <ul><li>提供在 etcd 中存储对象的一致方式。</li> <li>执行这些对象的验证，以便客户端无法存储配置不正确的对象，如果它们直接写入 etcd 数据存储区可能会发生这种情况。</li> <li>提供 RESTful API 来创建、更新、修改或删除资源。</li> <li>提供乐观并发锁定，因此在并发更新的情况下，对对象的更改永远不会被其他客户端覆盖。</li> <li>对客户端发送的请求执行身份验证和授权。它使用插件提取客户端的用户名、用户 ID 和用户所属的组，并确定经过身份验证的用户是否可以对请求的资源执行请求的操作。</li> <li>如果请求试图创建、修改或删除资源，则执行<font color="blue"><strong>准入控制[2]</strong></font>。示例：AlwaysPullImages、DefaultStorageClass、ResourceQuota 等。</li> <li>为客户端实现监视机制（类似于 etcd）以监视更改。这允许调度程序和 Controller Manager 等组件以松散耦合的方式与 API Server 交互。</li></ul> <h2 id="controller-manager"><a href="#controller-manager" class="header-anchor">#</a> Controller Manager</h2> <p>在 Kubernetes 中，控制器是监控集群状态的控制循环，然后根据需要进行更改或请求更改。每个控制器都尝试将当前集群状态移动到更接近所需状态。控制器跟踪至少一种 Kubernetes 资源类型，并且这些对象有一个表示所需状态的规范字段。</p> <p>控制器示例：</p> <ul><li>Replication Manager（ReplicationController 资源的控制器）</li> <li>ReplicaSet、DaemonSet 和 Job 控制器</li> <li>Deployment 控制器</li> <li>StatefulSet 控制器</li> <li>Node 控制器</li> <li>Service 控制器</li> <li>Endpoints 控制器</li> <li>Namespace 控制器</li> <li>PersistentVolume 控制器
控制器使用监视机制来获得更改通知。他们监视 API Server 对资源的更改并针对每个更改执行操作，无论是创建新对象还是更新或删除现有对象。大多数时候，这些操作包括创建其他资源或自己更新被监视的资源，但是由于使用监视并不能保证控制器不会错过任何事件，它们还会定期执行重新列出操作以确保没有错过了任何东西。</li></ul> <p>Controller Manager 还执行生命周期功能，例如命名空间创建和生命周期、事件垃圾回收、终止 pod 垃圾回收、<font color="blue"><strong>级联删除垃圾回收[3]</strong></font>、节点垃圾回收等。</p> <h2 id="scheduler"><a href="#scheduler" class="header-anchor">#</a> Scheduler</h2> <p>调度程序是一个控制平面进程，它将 pod 分配给节点。它监视没有分配节点的新创建的 pod，并且对于调度程序发现的每个 pod，调度程序负责为该 pod 找到运行的最佳节点。</p> <p>满足 Pod 调度要求的节点称为可行节点。如果没有合适的节点，则 pod 将保持未调度状态，直到调度程序能够放置它。一旦找到可行节点，它就会运行一组函数来对节点进行评分，并选择得分最高的节点。然后它会通知 API Server 有关所选节点的信息，此过程称为绑定。</p> <p>节点的选择分为两步：</p> <ol><li><p><strong>过滤</strong>所有节点的列表以获取 pod 可以调度到的可接受节点列表。（例如，PodFitsResources 过滤器检查候选节点是否有足够的可用资源来满足 Pod 的特定资源请求）</p></li> <li><p><strong>对从第 1 步获得的节点列表进行评分</strong>并对它们进行排名以选择最佳节点。如果多个节点得分最高，则使用循环法确保 pod 均匀地部署在所有节点上。
调度决策需要考虑的因素包括：</p></li></ol> <ul><li>Pod 对硬件/软件资源的请求？节点是否报告内存或磁盘压力情况？</li> <li>该节点是否具有与 pod 规范中的节点选择器匹配的标签？</li> <li>如果 pod 请求绑定到特定的主机端口，该端口是否已在该节点上占用？</li> <li>pod 是否容忍节点的污点？</li> <li>pod 是否指定节点亲和性或反亲和性规则？等。
调度程序不会指示所选节点运行 pod。Scheduler 所做的只是通过 API Server 更新 pod 定义。API server 通过 watch 机制通知 Kubelet pod 已经被调度。然后目标节点上的 kubelet 服务看到 pod 已被调度到它的节点，它创建并运行 pod 的容器。</li></ul> <h1 id="工作节点组件"><a href="#工作节点组件" class="header-anchor">#</a> 工作节点组件</h1> <h2 id="kubelet"><a href="#kubelet" class="header-anchor">#</a> Kubelet</h2> <p>Kubelet 是在集群中的每个节点上运行的代理，是负责在工作节点上运行的所有内容的组件。它确保容器在 Pod 中运行。</p> <p>kubelet 服务的主要功能有：</p> <ol><li>通过在 API Server 中创建节点资源来注册它正在运行的节点。</li> <li>持续监控 API Server 上已调度到节点的 Pod。</li> <li>使用配置的容器运行时启动 pod 的容器。</li> <li>持续监控正在运行的容器并将其状态、事件和资源消耗报告给 API Server。</li> <li>运行容器活性探测，在探测失败时重新启动容器，在容器的 Pod 从 API Server 中删除时终止容器，并通知服务器 Pod 已终止。</li></ol> <h2 id="kube-proxy"><a href="#kube-proxy" class="header-anchor">#</a> kube-proxy</h2> <p>它在每个节点上运行，并确保一个 pod 可以与另一个 pod 对话，一个节点可以与另一个节点对话，一个容器可以与另一个容器通信等。它负责监视 API Server 以了解Service和 pod 定义的更改，以保持整个网络配置的最新状态。当一个Service由多个 pod 时，proxy会在这些 pod 之间负载平衡。</p> <p>kube-proxy 之所以得名，是因为它是一个实际的代理服务器，用于接受连接并将它们代理到 Pod，当前的实现使用 iptables 或 ipvs 规则将数据包重定向到随机选择的后端 Pod，而不通过实际的代理服务器传递它们。</p> <ol><li>创建服务时，会立即分配一个虚拟 IP 地址。</li> <li>API Server 通知在工作节点上运行的 kube-proxy 代理已经创建了新服务。</li> <li>每个 kube-proxy 通过设置 iptables 规则使服务可寻址，确保拦截每个服务 IP/端口对，并将目标地址修改为支持服务的 pod 之一。</li> <li>监视 API Server 对服务或其端点对象的更改。</li></ol> <h1 id="容器运行时"><a href="#容器运行时" class="header-anchor">#</a> 容器运行时</h1> <p>专注于运行容器、设置命名空间和容器的 cgroup 的容器运行时称为低级容器运行时，专注于格式、解包、管理和共享images并提供 API 以满足开发人员需求的容器运行时称为高级容器运行时（容器引擎）。</p> <p>容器运行时负责：</p> <ol><li>如果本地不可用，则从镜像注册表中拉取容器所需的容器镜像。</li> <li>将镜像提取到写入时复制文件系统，所有容器层相互重叠以创建合并文件系统。</li> <li>准备容器挂载点</li> <li>从容器镜像设置元数据，例如覆盖 CMD、来自用户输入的 ENTRYPOINT、设置 SECCOMP 规则等，以确保容器按预期运行。</li> <li>更改内核以向该容器分配某种隔离，例如进程、网络和文件系统。</li> <li>提醒内核分配一些资源限制，如 CPU 或内存限制。</li> <li>将系统调用（syscall）传递给内核以启动容器。</li> <li>确保 SElinux/AppArmor 设置正确。</li></ol> <h3 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h3> <p><a href="https://www.geeksforgeeks.org/raft-consensus-algorithm/" target="_blank" rel="noopener noreferrer">[1] RAFT 共识算法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <br><a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/" target="_blank" rel="noopener noreferrer">[2] 准入控制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <br><a href="https://kubernetes.io/docs/concepts/architecture/garbage-collection" target="_blank" rel="noopener noreferrer">[3] 级联删除垃圾回收<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>本文作者：<a href="https://dbsecurity.com.cn/" target="_blank" rel="noopener noreferrer">许怀安<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <br>创作时间：2022.06.16
<br>版权声明：本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener noreferrer">BY-NC-SA<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>许可协议。转载请禀明出处！</p></blockquote></div></div> <div class="page-slot page-slot-bottom">
  <div class="wwads-cn wwads-horizontal pageB" data-id="136" style="width:100%;max-height:80px;min-height:auto;"></div>
  <style>
    .pageB img{width:80px!important;}
    .wwads-horizontal .wwads-text, .wwads-content .wwads-text{line-height:1;}
  </style>
  </div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/12/19, 23:30:50</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/fe78f5/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">MySQL主从同步</div></a> <a href="/pages/77e71c/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Kubernets基于RBAC的认证与授权</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/fe78f5/" class="prev">MySQL主从同步</a></span> <span class="next"><a href="/pages/77e71c/">Kubernets基于RBAC的认证与授权</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:keington@outlook.com" title="Email" target="_blank" class="iconfont icon-youjian"></a><a href="tencent://message/?uin=qq1950974755&amp;Site=Sambow&amp;Menu=yes" title="QQ" target="_blank" class="iconfont icon-QQ"></a><a href="https://github.com/keington/" title="Github" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/keington/" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2022
    <span>许怀安 | MIT License <br> <a target="_blank" href="http://beian.miit.gov.cn/" >青ICP备2022000072号-1</a><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=63010302000386" > | 青公网安备 63010302000386号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div>
    <div class="wwads-cn wwads-vertical windowRB" data-id="136" style="max-width:160px;
    min-width: auto;min-height:auto;"></div>
    <style>
      .windowRB{ padding: 0;}
      .windowRB .wwads-img{margin-top: 10px;}
      .windowRB .wwads-content{margin: 0 10px 10px 10px;}
      .custom-html-window-rb .close-but{
        display: none;
      }
    </style>
  </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.d8da32ae.js" defer></script><script src="/assets/js/2.f60e7fe1.js" defer></script><script src="/assets/js/10.9e8339da.js" defer></script>
  </body>
</html>
