<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Centos7主机安全加固 | XuHuaian,s Blog</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/images/logo1.png">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_1678482_4tbhmh589x.css">
    <meta name="description" content="记录自己的工作学习心得，争取当一条有梦想的咸鱼">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.87484ee6.css" as="style"><link rel="preload" href="/assets/js/app.eb5ce122.js" as="script"><link rel="preload" href="/assets/js/2.e0447311.js" as="script"><link rel="preload" href="/assets/js/9.3befcc2b.js" as="script"><link rel="prefetch" href="/assets/js/10.a4c1b08c.js"><link rel="prefetch" href="/assets/js/11.c32413bc.js"><link rel="prefetch" href="/assets/js/12.76253710.js"><link rel="prefetch" href="/assets/js/13.5dfb1e5a.js"><link rel="prefetch" href="/assets/js/14.b5cf0758.js"><link rel="prefetch" href="/assets/js/15.ea69f4a8.js"><link rel="prefetch" href="/assets/js/16.a07693e5.js"><link rel="prefetch" href="/assets/js/17.f3166f30.js"><link rel="prefetch" href="/assets/js/18.f492c0ee.js"><link rel="prefetch" href="/assets/js/19.fcf9b647.js"><link rel="prefetch" href="/assets/js/20.c0ed5031.js"><link rel="prefetch" href="/assets/js/21.c7efd6c7.js"><link rel="prefetch" href="/assets/js/22.5ffde374.js"><link rel="prefetch" href="/assets/js/23.701c8c40.js"><link rel="prefetch" href="/assets/js/24.84e3e077.js"><link rel="prefetch" href="/assets/js/25.7e6d48b5.js"><link rel="prefetch" href="/assets/js/26.2ac671af.js"><link rel="prefetch" href="/assets/js/27.34073ce3.js"><link rel="prefetch" href="/assets/js/28.f39500c9.js"><link rel="prefetch" href="/assets/js/29.3fe5e297.js"><link rel="prefetch" href="/assets/js/3.ce2f48b2.js"><link rel="prefetch" href="/assets/js/30.9d016643.js"><link rel="prefetch" href="/assets/js/31.5e1f7f85.js"><link rel="prefetch" href="/assets/js/32.5b660dc3.js"><link rel="prefetch" href="/assets/js/4.279b270d.js"><link rel="prefetch" href="/assets/js/5.0835fa05.js"><link rel="prefetch" href="/assets/js/6.16ec2ecd.js"><link rel="prefetch" href="/assets/js/7.26dc8428.js"><link rel="prefetch" href="/assets/js/8.164c2072.js">
    <link rel="stylesheet" href="/assets/css/0.styles.87484ee6.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open no-sidebar have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.jpg" alt="XuHuaian,s Blog" class="logo"> <span class="site-name can-hide">XuHuaian,s Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>gRP笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/52d5c3/" class="nav-link">RPC</a></li><li class="dropdown-subitem"><a href="/pages/a2f161/" class="nav-link">gRPC</a></li><li class="dropdown-subitem"><a href="/pages/793dcb/" class="nav-link">Hello gRPC</a></li><li class="dropdown-subitem"><a href="/pages/2f674a/" class="nav-link">gRPC Bug</a></li></ul></li><li class="dropdown-item"><h4>HuTool笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5fedc1/" class="nav-link">HuTool</a></li><li class="dropdown-subitem"><a href="/pages/f83d9d/" class="nav-link">HuTool组件</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/82aec0/" class="nav-link">使用systemctl命令管理部署Java jar包</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/af9ce4/" class="nav-link">Linux下挖矿病毒排杀过程</a></li><li class="dropdown-subitem"><a href="/pages/11d270/" class="nav-link">Linux主机巡检脚本</a></li></ul></li><li class="dropdown-item"><h4>Centos内核升级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/42150c/" class="nav-link">在线升级</a></li><li class="dropdown-subitem"><a href="/pages/79a802/" class="nav-link">离线升级</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络安全" class="dropdown-title"><!----> <span class="title" style="display:;">网络安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>主机安全</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b5a32b/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Centos主机安全加固</a></li></ul></li><li class="dropdown-item"><h4>安全通告</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/42dce9/" class="nav-link">fastjson反序列化漏洞2022-5-23</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><!----> <span class="title" style="display:;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>环境搭建</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a32ce8/" class="nav-link">Windows下Java开发环境搭建</a></li><li class="dropdown-subitem"><a href="/pages/f22bdb/" class="nav-link">Linux下Java运行环境搭建</a></li></ul></li><li class="dropdown-item"><h4>博客搭建</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/0737a0/" class="nav-link">Vuepress搭建博客</a></li><li class="dropdown-subitem"><a href="/pages/c21fef/" class="nav-link">微信云托管部署Vuepress</a></li></ul></li><li class="dropdown-item"><h4>踩坑记录</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9c7c7b/" class="nav-link">Nginx报错403</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><!----> <span class="title" style="display:;">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/db78e2/" class="nav-link">关于我</a></li><li class="dropdown-item"><!----> <a href="/pages/0f7590/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/keington/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/images/logo.jpg"> <div class="blogger-info"><h3>许怀安</h3> <span>所思，所学，所想，所行</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>gRP笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/52d5c3/" class="nav-link">RPC</a></li><li class="dropdown-subitem"><a href="/pages/a2f161/" class="nav-link">gRPC</a></li><li class="dropdown-subitem"><a href="/pages/793dcb/" class="nav-link">Hello gRPC</a></li><li class="dropdown-subitem"><a href="/pages/2f674a/" class="nav-link">gRPC Bug</a></li></ul></li><li class="dropdown-item"><h4>HuTool笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/5fedc1/" class="nav-link">HuTool</a></li><li class="dropdown-subitem"><a href="/pages/f83d9d/" class="nav-link">HuTool组件</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/82aec0/" class="nav-link">使用systemctl命令管理部署Java jar包</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Linux</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/af9ce4/" class="nav-link">Linux下挖矿病毒排杀过程</a></li><li class="dropdown-subitem"><a href="/pages/11d270/" class="nav-link">Linux主机巡检脚本</a></li></ul></li><li class="dropdown-item"><h4>Centos内核升级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/42150c/" class="nav-link">在线升级</a></li><li class="dropdown-subitem"><a href="/pages/79a802/" class="nav-link">离线升级</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="网络安全" class="dropdown-title"><!----> <span class="title" style="display:;">网络安全</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>主机安全</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/b5a32b/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Centos主机安全加固</a></li></ul></li><li class="dropdown-item"><h4>安全通告</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/42dce9/" class="nav-link">fastjson反序列化漏洞2022-5-23</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><!----> <span class="title" style="display:;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>环境搭建</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/a32ce8/" class="nav-link">Windows下Java开发环境搭建</a></li><li class="dropdown-subitem"><a href="/pages/f22bdb/" class="nav-link">Linux下Java运行环境搭建</a></li></ul></li><li class="dropdown-item"><h4>博客搭建</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/0737a0/" class="nav-link">Vuepress搭建博客</a></li><li class="dropdown-subitem"><a href="/pages/c21fef/" class="nav-link">微信云托管部署Vuepress</a></li></ul></li><li class="dropdown-item"><h4>踩坑记录</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/9c7c7b/" class="nav-link">Nginx报错403</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><!----> <span class="title" style="display:;">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/db78e2/" class="nav-link">关于我</a></li><li class="dropdown-item"><!----> <a href="/pages/0f7590/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/keington/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <!----> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-0c557b5e><div class="articleInfo" data-v-0c557b5e><ul class="breadcrumbs" data-v-0c557b5e><li data-v-0c557b5e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-0c557b5e></a></li> <li data-v-0c557b5e><a href="/categories/?category=%E5%AE%89%E5%85%A8" title="分类" data-v-0c557b5e>安全</a></li><li data-v-0c557b5e><a href="/categories/?category=%E4%B8%BB%E6%9C%BA%E5%AE%89%E5%85%A8" title="分类" data-v-0c557b5e>主机安全</a></li></ul> <div class="info" data-v-0c557b5e><div title="作者" class="author iconfont icon-touxiang" data-v-0c557b5e><a href="https://github.com/keington" target="_blank" title="作者" class="beLink" data-v-0c557b5e>许怀安</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-0c557b5e><a href="javascript:;" data-v-0c557b5e>2022-05-22</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Centos7主机安全加固<!----></h1>  <div class="theme-vdoing-content content__default"><div class="custom-block tip"><p class="custom-block-title">Tips</p> <p>本文从Centos 7.x系列系统的16个角度来加固主机的安全性，不足之处，敬请谅解。</p></div> <h2 id="一、密码长度与有效期"><a href="#一、密码长度与有效期" class="header-anchor">#</a> 一、密码长度与有效期</h2> <h3 id="_1-1-默认配置"><a href="#_1-1-默认配置" class="header-anchor">#</a> 1.1 默认配置</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> /etc/login.defs <span class="token operator">|</span><span class="token function">grep</span> PASS_ <span class="token operator">|</span><span class="token function">grep</span> -v <span class="token string">'#'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><ul><li>PASS_MAX_DAYS 99999</li> <li>PASS_MIN_DAYS 0</li> <li>PASS_MIN_LEN 5</li> <li>PASS_WARN_AGE 7</li></ul></blockquote> <h3 id="_1-2-加固方案"><a href="#_1-2-加固方案" class="header-anchor">#</a> 1.2 加固方案：</h3> <h4 id="_1-2-1-备份配置文件"><a href="#_1-2-1-备份配置文件" class="header-anchor">#</a> 1.2.1 备份配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/login.defs /etc/login.defs.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_1-2-2-编辑配置文件并将相关参数改成如下"><a href="#_1-2-2-编辑配置文件并将相关参数改成如下" class="header-anchor">#</a> 1.2.2 编辑配置文件并将相关参数改成如下</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/login.defs
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><ul><li>PASS_MAX_DAYS 90</li> <li>PASS_MIN_DAYS 6</li> <li>PASS_MIN_LEN 8</li> <li>PASS_WARN_AGE 30</li></ul></blockquote> <div class="custom-block tip"><p class="custom-block-title">备注</p> <p>/etc/login.defs文件的pass_min_len 参数并不具备强制性，测试仍然可以设置7位密码。最终需要cracklib来实现。</p></div> <h4 id="_1-2-3-参数说明"><a href="#_1-2-3-参数说明" class="header-anchor">#</a> 1.2.3 参数说明:</h4> <blockquote><ul><li>PASS_MAX_DAYS 密码有效期</li> <li>PASS_MIN_DAYS 修改密码的最短期限</li> <li>PASS_MIN_LEN 密码最短长度</li> <li>PASS_WARN_AGE 密码过期提醒</li></ul></blockquote> <h2 id="二、密码复杂度"><a href="#二、密码复杂度" class="header-anchor">#</a> 二、密码复杂度</h2> <h3 id="_2-1-默认配置"><a href="#_2-1-默认配置" class="header-anchor">#</a> 2.1 默认配置</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> /etc/pam.d/system-auth <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type=&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>password requisite pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type=</p></blockquote> <h3 id="_2-2-加固方案"><a href="#_2-2-加固方案" class="header-anchor">#</a> 2.2 加固方案</h3> <h4 id="_2-2-1-备份配置文件"><a href="#_2-2-1-备份配置文件" class="header-anchor">#</a> 2.2.1 备份配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/pam.d/system-auth /etc/pam.d/system-auth.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2-2-2-编辑配置文件"><a href="#_2-2-2-编辑配置文件" class="header-anchor">#</a> 2.2.2 编辑配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/pam.d/system-auth
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>将</p> <blockquote><ul><li>password requisite pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type=</li></ul></blockquote> <p>注释并在其下面新增1行</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>password requisite pam_cracklib.so try_first_pass <span class="token assign-left variable">minlen</span><span class="token operator">=</span><span class="token number">8</span> <span class="token assign-left variable">difok</span><span class="token operator">=</span><span class="token number">5</span> <span class="token assign-left variable">dcredit</span><span class="token operator">=</span>-1 <span class="token assign-left variable">lcredit</span><span class="token operator">=</span>-1 <span class="token assign-left variable">ocredit</span><span class="token operator">=</span>-1 <span class="token assign-left variable">retry</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">type</span><span class="token operator">=</span>

:wq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">备注</p> <p>try_first_pass而当pam_unix验证模块与password验证类型一起使用时，该选项主要用来防止用户新设定的密码与以前的旧密码相同。</p> <blockquote><ul><li>minlen=8：最小长度8位</li> <li>difok=5:新、旧密码最少5个字符不同</li> <li>dcredit=-1：最少1个数字</li> <li>lcredit=-1：最少1个小写字符，（ucredit=-1:最少1个大写字符)</li> <li>ocredit=-1：最少1个特殊字符</li> <li>retry=1:1次错误后返回错误信息</li> <li>type=xxx：此选项用来修改缺省的密码提示文本</li></ul></blockquote></div> <h2 id="三、新口令不能与4个最近使用的相同"><a href="#三、新口令不能与4个最近使用的相同" class="header-anchor">#</a> 三、新口令不能与4个最近使用的相同</h2> <h3 id="_3-1-默认配置"><a href="#_3-1-默认配置" class="header-anchor">#</a> 3.1 默认配置</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> /etc/pam.d/system-auth <span class="token operator">|</span><span class="token function">grep</span> use_authtok
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>ssword sufficient pam_unix.so sha512 shadow nullok try_first_pass use_authtok</p></blockquote> <h3 id="_3-2加固方案"><a href="#_3-2加固方案" class="header-anchor">#</a> 3.2加固方案</h3> <h4 id="_3-2-1-备份配置文件"><a href="#_3-2-1-备份配置文件" class="header-anchor">#</a> 3.2.1 备份配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/pam.d/system-auth /etc/pam.d/system-auth.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3-3-2-编辑配置文件"><a href="#_3-3-2-编辑配置文件" class="header-anchor">#</a> 3.3.2 编辑配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/pam.d/system-auth
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在password sufficient pam_unix.so sha512 shadow nullok try_first_pass use_authtok 所在行的后面添加</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">member</span><span class="token operator">=</span><span class="token number">5</span>  <span class="token comment"># 记住5个历史密码</span>

:wq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="四、设置会话超时-5分钟"><a href="#四、设置会话超时-5分钟" class="header-anchor">#</a> 四、设置会话超时（5分钟）</h2> <h3 id="_4-1-默认配置"><a href="#_4-1-默认配置" class="header-anchor">#</a> 4.1 默认配置</h3> <p><font color="red"><strong>无</strong></font></p> <h3 id="_4-2-加固方案"><a href="#_4-2-加固方案" class="header-anchor">#</a> 4.2 加固方案</h3> <h4 id="_4-2-1-备份配置文件"><a href="#_4-2-1-备份配置文件" class="header-anchor">#</a> 4.2.1 备份配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/profile /etc/profile.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4-2-2-编辑配置文件"><a href="#_4-2-2-编辑配置文件" class="header-anchor">#</a> 4.2.2 编辑配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vi</span> /etc/profile
在文件的末尾添加参数

port <span class="token assign-left variable">TMOUT</span><span class="token operator">=</span><span class="token number">300</span> <span class="token comment"># 五分钟无操作中断登录会话</span>

:wq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="五、设置history命令时间戳"><a href="#五、设置history命令时间戳" class="header-anchor">#</a> 五、设置history命令时间戳</h2> <h3 id="_5-1-默认配置"><a href="#_5-1-默认配置" class="header-anchor">#</a> 5.1 默认配置</h3> <p><font color="red"><strong>无</strong></font></p> <h3 id="_5-2-加固方案"><a href="#_5-2-加固方案" class="header-anchor">#</a> 5.2 加固方案</h3> <h4 id="_5-2-1-备份配置文件"><a href="#_5-2-1-备份配置文件" class="header-anchor">#</a> 5.2.1 备份配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/profile /etc/profile.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_5-2-2-编辑配置文件"><a href="#_5-2-2-编辑配置文件" class="header-anchor">#</a> 5.2.2 编辑配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vi</span> /etc/profile
在文件的末尾添加参数

<span class="token builtin class-name">export</span> <span class="token assign-left variable">HISTTIMEFORMAT</span><span class="token operator">=</span><span class="token string">&quot;%F %T ‘whoami’ &quot;</span>

:wq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="六、设置登陆失败锁定"><a href="#六、设置登陆失败锁定" class="header-anchor">#</a> 六、设置登陆失败锁定</h2> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>（只能限定终端登录，图形界面依然可以登录）</p></div> <h3 id="_6-1-默认配置"><a href="#_6-1-默认配置" class="header-anchor">#</a> 6.1 默认配置</h3> <p><font color="red"><strong>无</strong></font></p> <h3 id="_6-2-加固方案"><a href="#_6-2-加固方案" class="header-anchor">#</a> 6.2 加固方案</h3> <h4 id="_6-2-1-备份配置文件"><a href="#_6-2-1-备份配置文件" class="header-anchor">#</a> 6.2.1 备份配置文件</h4> <p><strong>1）方法一修改PAM配置文件</strong></p> <blockquote><p>/etc/pam.d/login中设定控制台</p> <p>/etc/pam.d/sshd中设定SSH</p> <p>/etc/pam.d/sshd中第二行添加下列信息</p></blockquote> <p><img src="data:image/png;base64,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" alt="avatar"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>pam_tally2 --user root  <span class="token comment"># 查看用户登录失败次数</span>

pam_tally2 -r -u root  <span class="token comment"># 解锁用户</span>

even_deny_root  <span class="token comment"># 也限制root用户(默认配置就锁定root帐号)</span>

deny  <span class="token comment"># 设置普通用户和root用户连续错误登陆的最大次数，超过最大次数，则锁定该用户</span>

unlock_time  <span class="token comment"># 设定普通用户锁定后，多少时间后解锁，单位是秒</span>

root_unlock_time  <span class="token comment"># 设定root用户锁定后，多少时间后解锁，单位是秒</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>2）方法二修改PAM Auth配置文件：</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/pam.d/system-auth
在<span class="token comment"># User changes will be destroyed the next time authconfig is run.行的下面，添加</span>

auth required pam_tally2.so <span class="token assign-left variable">deny</span><span class="token operator">=</span><span class="token number">5</span> <span class="token assign-left variable">unlock_time</span><span class="token operator">=</span><span class="token number">1800</span> even_deny_root <span class="token assign-left variable">root_unlock_time</span><span class="token operator">=</span><span class="token number">1800</span>
<span class="token comment"># 通过终端登录，5次登录失败后锁定账号30分钟，锁定期间此账号无法再次登录</span>

:wq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="七、禁止root通过ssh远程登录"><a href="#七、禁止root通过ssh远程登录" class="header-anchor">#</a> 七、禁止root通过ssh远程登录</h2> <h3 id="_7-1-默认配置"><a href="#_7-1-默认配置" class="header-anchor">#</a> 7.1 默认配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># cat /etc/ssh/sshd_config |grep PermitRootLogin</span>
<span class="token comment">#PermitRootLogin yes</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_7-2-加固方案"><a href="#_7-2-加固方案" class="header-anchor">#</a> 7.2 加固方案</h3> <h4 id="_7-2-1备份配置文件"><a href="#_7-2-1备份配置文件" class="header-anchor">#</a> 7.2.1备份配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/ssh/sshd_config /etc/ssh/sshd_config.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_7-2-2-编辑配置文件"><a href="#_7-2-2-编辑配置文件" class="header-anchor">#</a> 7.2.2 编辑配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/ssh/sshd_config

将配置参数<span class="token comment">#PermitRootLogin yes改成PermitRootLogin no</span>

:wq

systemctl restart sshd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>PermitRootLogin参数设置为<strong>no</strong>后root用户无法直接登录，必须用普通用户登录 提权 后才能使用root权限</p></div> <h2 id="八、ssh-配置参数增强"><a href="#八、ssh-配置参数增强" class="header-anchor">#</a> 八、SSH 配置参数增强</h2> <h3 id="_8-1-备份配置文件"><a href="#_8-1-备份配置文件" class="header-anchor">#</a> 8.1 备份配置文件</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/ssh/sshd_config /etc/ssh/sshd_config.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_8-2-编辑配置文件"><a href="#_8-2-编辑配置文件" class="header-anchor">#</a> 8.2 编辑配置文件</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/ssh/sshd_config

<span class="token number">1</span>）禁止空密码登录
将<span class="token comment">#PermitEmptyPasswords no参数的注释符号去掉，改成</span>

PermitEmptyPasswords no

<span class="token number">2</span>）关闭ssh的tcp转发
将<span class="token comment">#AllowTcpForwarding yes参数改成</span>

AllowTcpForwarding no

<span class="token number">3</span>）关闭S/KEY（质疑-应答<span class="token punctuation">)</span>认证方式
将<span class="token comment">#ChallengeResponseAuthentication yes参数，改成</span>

ChallengeResponseAuthentication no

<span class="token number">4</span>）关闭基于GSSAPI 的用户认证
将GSSAPIAuthentication yes参数，改成

GSSAPIAuthentication no

:wq

systemctl restart sshd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="九、设置ssh登录警告语"><a href="#九、设置ssh登录警告语" class="header-anchor">#</a> 九、设置SSH登录警告语</h2> <h3 id="_9-1-默认配置"><a href="#_9-1-默认配置" class="header-anchor">#</a> 9.1 默认配置</h3> <p><font color="red"><strong>无</strong></font></p> <h3 id="_9-2-加固方案"><a href="#_9-2-加固方案" class="header-anchor">#</a> 9.2 加固方案</h3> <h4 id="_9-2-1-备份配置文件"><a href="#_9-2-1-备份配置文件" class="header-anchor">#</a> 9.2.1 备份配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/ssh/sshd_config /etc/ssh/sshd_config.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_9-2-2-编辑配置文件"><a href="#_9-2-2-编辑配置文件" class="header-anchor">#</a> 9.2.2 编辑配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/ssh/sshd_config

找到<span class="token comment">#Banner none参数，在其下一行，增加</span>

Banner /etc/ssh/alert

:wq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_9-2-3-新增告警信息文件"><a href="#_9-2-3-新增告警信息文件" class="header-anchor">#</a> 9.2.3 新增告警信息文件</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/ssh/alert
文件内容，设置成

*******************************************************

这部分内容自定义，可以提示一下登录的用户引起运维人员重视

Warning<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>Any Access Without Permission Is Forbidden<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>

          警告<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span> 未经许可禁止访问！！！

*******************************************************

:wq

systemctl restart sshd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="十、设置umask值"><a href="#十、设置umask值" class="header-anchor">#</a> 十、设置umask值</h2> <h3 id="_10-1-默认配置"><a href="#_10-1-默认配置" class="header-anchor">#</a> 10.1 默认配置</h3> <blockquote><p>#umask</p> <p>0022</p></blockquote> <h3 id="_10-2-加固方案"><a href="#_10-2-加固方案" class="header-anchor">#</a> 10.2 加固方案</h3> <h4 id="_10-2-1-备份配置文件"><a href="#_10-2-1-备份配置文件" class="header-anchor">#</a> 10.2.1 备份配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/bashrc /etc/bashrc.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_10-2-2-编辑用户变量配置文件"><a href="#_10-2-2-编辑用户变量配置文件" class="header-anchor">#</a> 10.2.2 编辑用户变量配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/bashrc

在文件末尾增加参数
<span class="token builtin class-name">umask</span> 027

:wq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_10-2-3-备份系统变量配置文件"><a href="#_10-2-3-备份系统变量配置文件" class="header-anchor">#</a> 10.2.3 备份系统变量配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/profile /etc/pr ofile.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_10-2-4-编辑配置文件"><a href="#_10-2-4-编辑配置文件" class="header-anchor">#</a> 10.2.4 编辑配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/profile

在文件末尾增加参数
<span class="token builtin class-name">umask</span> 027

:wq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">备注</p> <p>将umask值设置成0027，用于拿掉新增目录与文件的非所有者和所有者所属组的访问权限</p> <p>默认：</p> <p>新增目录权限755，即 rxwr-xr-x</p> <p>新增文件权限644，即 rw-r–r—</p> <p>加固后：</p> <p>新增目录权限750，即 rxwr-x—</p> <p>新增文件权限640，即 rw-r-----</p></div> <h2 id="十一、禁止control-alt-delete-键盘重启系统命令"><a href="#十一、禁止control-alt-delete-键盘重启系统命令" class="header-anchor">#</a> 十一、禁止Control-Alt-Delete 键盘重启系统命令</h2> <h3 id="_11-1-默认配置"><a href="#_11-1-默认配置" class="header-anchor">#</a> 11.1 默认配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">ls</span> /usr/lib/systemd/system/ctrl-alt-del.target
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_11-2-加固方案"><a href="#_11-2-加固方案" class="header-anchor">#</a> 11.2 加固方案</h3> <h4 id="_11-2-1-备份配置文件"><a href="#_11-2-1-备份配置文件" class="header-anchor">#</a> 11.2.1 备份配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /usr/lib/systemd/system/ctrl-alt-del.target /usr/lib/systemd/system/ctrl-alt-del.target.default

移除该原源文件
<span class="token function">rm</span> -rf /usr/lib/systemd/system/ctrl-alt-del.target
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="十二、隐藏系统版本信息"><a href="#十二、隐藏系统版本信息" class="header-anchor">#</a> 十二、隐藏系统版本信息</h2> <h2 id="_12-1-默认配置"><a href="#_12-1-默认配置" class="header-anchor">#</a> 12.1 默认配置</h2> <p><font color="red"><strong>无</strong></font></p> <h2 id="_12-2-加固方案"><a href="#_12-2-加固方案" class="header-anchor">#</a> 12.2 加固方案:</h2> <p>执行以下命令：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mv</span> /etc/issue /etc/issue.bak

<span class="token function">mv</span> /etc/issue.net /etc/issue.net.bak
<span class="token comment"># 登录界面显示系统版本信息</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="十三、设置grup密码"><a href="#十三、设置grup密码" class="header-anchor">#</a> 十三、设置grup密码</h2> <h3 id="_13-1-默认配置"><a href="#_13-1-默认配置" class="header-anchor">#</a> 13.1 默认配置</h3> <p><font color="red"><strong>无</strong></font></p> <h3 id="_13-2-加固方案"><a href="#_13-2-加固方案" class="header-anchor">#</a> 13.2 加固方案</h3> <h4 id="_13-2-1-备份配置文件"><a href="#_13-2-1-备份配置文件" class="header-anchor">#</a> 13.2.1 备份配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/grub.d/00_header /etc/grub.d/00_header.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_13-2-2-使用grub2-mkpasswd-pbkdf2-加密"><a href="#_13-2-2-使用grub2-mkpasswd-pbkdf2-加密" class="header-anchor">#</a> 13.2.2 使用grub2-mkpasswd-pbkdf2 加密</h4> <div class="custom-block warning"><p class="custom-block-title">Tips</p> <p>使用grub2-mkpasswd-pbkdf2 加密密码（密码自己定义，但是一定得保存好否则最后连自己都登录不进去）</p></div> <p><strong>操作进行GRUB加密码的2种方式</strong></p> <p><em><strong>密文密码</strong></em></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># grub2-mkpasswd-pbkdf2</span>

Enter password:

Reenter password:

PBKDF2 <span class="token builtin class-name">hash</span> of your password is grub.pbkdf2.sha512.10000.B157F42E96462AB239C03000F113D32EB18FD48073F1FC7D8F87A8F3B3F89F662424ECCAB901F3A812A997E547FD520F3E99D0E080F4FE8B05E019757E34F75B.29C83F87B4B6C086FC9A81E046CC3623CC5CF2F82128EDC3A0364894E429D4993B28563F82D71BF346188108CBD4341FC4A71B90E543581646B4E7EAE920C54A

添加以下配置到该文件的最后面
<span class="token punctuation">(</span>特别需要注意 用户名root和密文之间是空格分隔，而不是换行<span class="token punctuation">)</span>

<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span>EOF

<span class="token builtin class-name">set</span> <span class="token assign-left variable">superusers</span><span class="token operator">=</span><span class="token string">'root'</span>

password_pbkdf2 root grub.pbkdf2.sha512.10000.B157F42E96462AB239C03000F113D32EB18FD48073F1FC7D8F87A8F3B3F89F662424ECCAB901F3A812A997E547FD520F3E99D0E080F4FE8B05E019757E34F75B.29C83F87B4B6C086FC9A81E046CC3623CC5CF2F82128EDC3A0364894E429D4993B28563F82D71BF346188108CBD4341FC4A71B90E543581646B4E7EAE920C54A

E0F
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>执行命令</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>重新编译生成grub.cfg文件</p> <p><em><strong>明文密码</strong></em></p> <p>修改/etc/grub.d/00_header,在文件末尾添加以下命令</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#admin by change grub password</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF
set superusers='user1'
password user1 123456
EOF</span>

:wq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>重新编译生成grub.cfg</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>grub2-mkconfig -o /boot/grub2/grub.cfg
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>重启检验，如用户密码输入“user1 123456”能成功登录系统，且能看到内核则成功</p> <h2 id="十四、最大文件打开数-文件句柄数"><a href="#十四、最大文件打开数-文件句柄数" class="header-anchor">#</a> 十四、最大文件打开数（文件句柄数）</h2> <h3 id="_14-1-默认配置"><a href="#_14-1-默认配置" class="header-anchor">#</a> 14.1 默认配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@i-1y3we23j ~<span class="token punctuation">]</span><span class="token comment"># ulimit -n</span>

<span class="token number">1024</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_14-2-加固方案"><a href="#_14-2-加固方案" class="header-anchor">#</a> 14.2 加固方案</h3> <h4 id="_14-2-1-备份配置文件"><a href="#_14-2-1-备份配置文件" class="header-anchor">#</a> 14.2.1 备份配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/security/limits.conf /etc/security/limits.conf.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_14-2-2-编辑配置文件"><a href="#_14-2-2-编辑配置文件" class="header-anchor">#</a> 14.2.2 编辑配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>添加以下两行配置到limits.conf文件最后
soft nofile <span class="token number">65535</span>

hard nofile <span class="token number">65535</span>  <span class="token comment"># 修改所有用户的最大文件打开数为65535</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="十五、用户最大进程数"><a href="#十五、用户最大进程数" class="header-anchor">#</a> 十五、用户最大进程数</h2> <h3 id="_15-1-默认配置"><a href="#_15-1-默认配置" class="header-anchor">#</a> 15.1 默认配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> /etc/security/limits.d/20-nproc.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Default limit <span class="token keyword">for</span> number of user's processes to prevent
accidental fork bombs.
See rhbz <span class="token comment">#432903 for reasoning.</span>
soft  nproc   <span class="token number">4096</span>
root    soft  nproc   unlimited
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_15-2-加固方案"><a href="#_15-2-加固方案" class="header-anchor">#</a> 15.2 加固方案</h3> <h4 id="_15-2-1-备份配置文件"><a href="#_15-2-1-备份配置文件" class="header-anchor">#</a> 15.2.1 备份配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/security/limits.d/20-nproc.conf /etc/security/limits.d/20-nproc.conf.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_15-2-2-修改配置文件"><a href="#_15-2-2-修改配置文件" class="header-anchor">#</a> 15.2.2 修改配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/security/limits.d/20-nproc.conf
soft   nproc   <span class="token number">65535</span>
hard  nproc   <span class="token number">65535</span>
<span class="token comment"># 修改所有用户的最大进程数为65535</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="十六、系统内核参数调优"><a href="#十六、系统内核参数调优" class="header-anchor">#</a> 十六、系统内核参数调优</h2> <h3 id="_16-1-默认配置"><a href="#_16-1-默认配置" class="header-anchor">#</a> 16.1 默认配置</h3> <p><font color="red"><strong>无</strong></font></p> <h3 id="_16-2-加固方案"><a href="#_16-2-加固方案" class="header-anchor">#</a> 16.2 加固方案</h3> <h4 id="_16-2-1-备份配置文件"><a href="#_16-2-1-备份配置文件" class="header-anchor">#</a> 16.2.1 备份配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> -a /etc/sysctl.conf /etc/sysctl.conf.default
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_16-2-2-编辑配置文件"><a href="#_16-2-2-编辑配置文件" class="header-anchor">#</a> 16.2.2 编辑配置文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>net.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.default.rp_filter <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.conf.default.accept_source_route <span class="token operator">=</span> <span class="token number">0</span>
kernel.sysrq <span class="token operator">=</span> <span class="token number">0</span>
kernel.core_uses_pid <span class="token operator">=</span> <span class="token number">1</span>
kernel.msgmnb <span class="token operator">=</span> <span class="token number">65536</span>
kernel.msgmax <span class="token operator">=</span> <span class="token number">65536</span>
kernel.shmmax <span class="token operator">=</span> <span class="token number">68719476736</span>
kernel.shmall <span class="token operator">=</span> <span class="token number">4294967296</span>
net.core.wmem_default <span class="token operator">=</span> <span class="token number">8388608</span>
net.core.rmem_default <span class="token operator">=</span> <span class="token number">8388608</span>
net.core.rmem_max <span class="token operator">=</span> <span class="token number">16777216</span>
net.core.wmem_max <span class="token operator">=</span> <span class="token number">16777216</span>
net.ipv4.route.gc_timeout <span class="token operator">=</span> <span class="token number">20</span>
net.ipv4.tcp_retries2 <span class="token operator">=</span> <span class="token number">5</span>
net.ipv4.tcp_fin_timeout <span class="token operator">=</span> <span class="token number">30</span>
net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">8192</span> <span class="token number">131072</span> <span class="token number">16777216</span>
net.ipv4.tcp_rmem <span class="token operator">=</span> <span class="token number">32768</span> <span class="token number">131072</span> <span class="token number">16777216</span>
net.ipv4.tcp_mem <span class="token operator">=</span> <span class="token number">94500000</span> <span class="token number">915000000</span> <span class="token number">927000000</span>
net.core.somaxconn <span class="token operator">=</span> <span class="token number">262144</span>
net.core.netdev_max_backlog <span class="token operator">=</span> <span class="token number">262144</span>
net.core.wmem_default <span class="token operator">=</span> <span class="token number">8388608</span>
net.core.rmem_default <span class="token operator">=</span> <span class="token number">8388608</span>
net.core.rmem_max <span class="token operator">=</span> <span class="token number">16777216</span>
net.core.wmem_max <span class="token operator">=</span> <span class="token number">16777216</span>
net.ipv4.route.gc_timeout <span class="token operator">=</span> <span class="token number">20</span>
net.ipv4.ip_local_port_range <span class="token operator">=</span> <span class="token number">10024</span> <span class="token number">65535</span>
net.ipv4.tcp_retries2 <span class="token operator">=</span> <span class="token number">5</span>
net.ipv4.tcp_syn_retries <span class="token operator">=</span> <span class="token number">2</span>
net.ipv4.tcp_synack_retries <span class="token operator">=</span> <span class="token number">2</span>
net.ipv4.tcp_timestamps <span class="token operator">=</span> <span class="token number">0</span>
net.ipv4.tcp_tw_recycle <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_tw_reuse <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_keepalive_time <span class="token operator">=</span> <span class="token number">1800</span>
net.ipv4.tcp_keepalive_probes <span class="token operator">=</span> <span class="token number">3</span>
net.ipv4.tcp_keepalive_intvl <span class="token operator">=</span> <span class="token number">30</span>
net.ipv4.tcp_max_orphans <span class="token operator">=</span> <span class="token number">3276800</span>
net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">8192</span> <span class="token number">131072</span> <span class="token number">16777216</span>
net.ipv4.tcp_rmem <span class="token operator">=</span> <span class="token number">32768</span> <span class="token number">131072</span> <span class="token number">16777216</span>
net.ipv4.tcp_mem <span class="token operator">=</span> <span class="token number">94500000</span> <span class="token number">915000000</span> <span class="token number">927000000</span>
fs.file-max <span class="token operator">=</span> <span class="token number">65535</span>
kernel.pid_max <span class="token operator">=</span> <span class="token number">65536</span>
net.ipv4.tcp_wmem <span class="token operator">=</span> <span class="token number">4096</span> <span class="token number">87380</span> <span class="token number">8388608</span>
net.core.wmem_max <span class="token operator">=</span> <span class="token number">8388608</span>
net.core.netdev_max_backlog <span class="token operator">=</span> <span class="token number">5000</span>
net.ipv4.tcp_window_scaling <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_max_syn_backlog <span class="token operator">=</span> <span class="token number">10240</span>
net.core.netdev_max_backlog <span class="token operator">=</span> <span class="token number">262144</span>
net.core.somaxconn <span class="token operator">=</span> <span class="token number">262144</span>
net.ipv4.tcp_max_orphans <span class="token operator">=</span> <span class="token number">3276800</span>
net.ipv4.tcp_max_syn_backlog <span class="token operator">=</span> <span class="token number">262144</span>
net.ipv4.tcp_timestamps <span class="token operator">=</span> <span class="token number">0</span>
net.ipv4.tcp_syn_retries <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_synack_retries <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_syncookies <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_tw_reuse <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_tw_recycle <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_fin_timeout <span class="token operator">=</span> <span class="token number">30</span>
net.ipv4.tcp_keepalive_time <span class="token operator">=</span> <span class="token number">120</span>
net.ipv4.ip_local_port_range <span class="token operator">=</span> <span class="token number">10000</span> <span class="token number">65000</span>
net.ipv4.tcp_max_syn_backlog <span class="token operator">=</span> <span class="token number">262144</span>
net.ipv4.tcp_max_tw_buckets <span class="token operator">=</span> <span class="token number">36000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>主机安全仅仅为网络安全中的一小部分，整个网络环境的安全防护不仅仅是靠加固主机安全就能完成，除此之外，还得需要一系列的安全设备（IDS、IPS、探针、WAF等等）、产品来完成
还需从应用层面去入手，代码审计，渗透测试，内部人员的审计，管理也很重要；世界上没有完全安全的网络，网络安全必须未雨绸缪，只有不断的去发掘漏洞，完善漏洞，才能让网络更加安全</p></div> <blockquote><p>本文作者：<a href="https://dbsecurity.com.cn/" target="_blank" rel="noopener noreferrer">许怀安<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <br>创作时间：2022.5.22
<br>版权声明：本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener noreferrer">BY-NC-SA<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>许可协议。转载请禀明出处！</p></blockquote></div></div> <div class="page-slot page-slot-bottom">
  <div class="wwads-cn wwads-horizontal pageB" data-id="136" style="width:100%;max-height:80px;min-height:auto;"></div>
  <style>
    .pageB img{width:80px!important;}
    .wwads-horizontal .wwads-text, .wwads-content .wwads-text{line-height:1;}
  </style>
  </div> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><!----> <!----></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:keington@outlook.com" title="Email" target="_blank" class="iconfont icon-youjian"></a><a href="tencent://message/?uin=qq1950974755&amp;Site=Sambow&amp;Menu=yes" title="QQ" target="_blank" class="iconfont icon-QQ"></a><a href="https://github.com/keington/" title="Github" target="_blank" class="iconfont icon-github"></a><a href="https://gitee.com/keington/" title="Gitee" target="_blank" class="iconfont icon-gitee"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2022
    <span>许怀安 | MIT License <br> <a target="_blank" href="http://beian.miit.gov.cn/" >青ICP备2022000072号-1</a><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=63010302000386" > | 青公网安备 63010302000386号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div>
    <div class="wwads-cn wwads-vertical windowRB" data-id="136" style="max-width:160px;
    min-width: auto;min-height:auto;"></div>
    <style>
      .windowRB{ padding: 0;}
      .windowRB .wwads-img{margin-top: 10px;}
      .windowRB .wwads-content{margin: 0 10px 10px 10px;}
      .custom-html-window-rb .close-but{
        display: none;
      }
    </style>
  </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.eb5ce122.js" defer></script><script src="/assets/js/2.e0447311.js" defer></script><script src="/assets/js/9.3befcc2b.js" defer></script>
  </body>
</html>
